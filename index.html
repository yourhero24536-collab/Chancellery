<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таблица вопросов и ответов</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f5f7fa;
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        thead {
            background: #3498db;
        }
        
        th {
            color: white;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
            border-right: 1px solid rgba(255,255,255,0.1);
        }
        
        th:last-child {
            border-right: none;
        }
        
        tbody tr {
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        td {
            padding: 18px 15px;
            vertical-align: top;
            border-right: 1px solid #eee;
        }
        
        td:last-child {
            border-right: none;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #95a5a6;
            font-size: 0.9rem;
        }
        
        .update-info {
            display: inline-block;
            background: #ecf0f1;
            padding: 10px 20px;
            border-radius: 20px;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Таблица вопросов и ответов</h1>
            <p>Данные автоматически обновляются из Google Таблицы</p>
        </div>
        
        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th width="5%">№</th>
                        <th width="35%">Вопрос</th>
                        <th width="50%">Ответ</th>
                        <th width="10%">От кого</th>
                    </tr>
</thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="4" class="loading">
                            <div class="loading-spinner"></div>
                            <p>Загрузка данных из Google Таблицы...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="footer">
            <div class="update-info">
                Последнее обновление: <span id="lastUpdate">-</span>
            </div>
            <p style="margin-top: 10px;">
                Ссылка на таблицу: 
                <a href="https://docs.google.com/spreadsheets/d/1KgaMITQ2RUxJBu8C5bXgLDJYFiS9UYhtawgezXSRXq4/edit?usp=sharing" 
                   target="_blank">
                    Открыть Google Таблицу
                </a>
            </p>
        </div>
    </div>
    
    <script>
        // Конфигурация
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1KgaMITQ2RUxJBu8C5bXgLDJYFiS9UYhtawgezXSRXq4/edit?usp=sharing';
        
        // Функция для получения публичной версии таблицы
        function getPublicSheetUrl() {
            // Изменяем URL для получения публичного доступа
            const sheetId = '1KgaMITQ2RUxJBu8C5bXgLDJYFiS9UYhtawgezXSRXq4';
            return https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=Sheet1;
        }
        
        // Загрузка данных из Google Sheets
        async function loadGoogleSheetData() {
            try {
                showLoading();
                
                // Получаем CSV данные
                const response = await fetch(getPublicSheetUrl());
                const csvText = await response.text();
                
                // Парсим CSV
                const rows = parseCSV(csvText);
                
                // Отображаем данные
                displayData(rows);
                
                // Обновляем время
                updateLastUpdateTime();
                
            } catch (error) {
                console.error('Ошибка загрузки:', error);
                showError('Не удалось загрузить данные. Проверьте доступность таблицы.');
            }
        }
        
        // Парсинг CSV
        function parseCSV(csvText) {
            const rows = [];
            const lines = csvText.split('\n');
            
            lines.forEach((line, index) => {
                if (line.trim() === '') return;
                
                // Простой парсинг CSV (для более сложных случаев используйте библиотеку)
                const columns = parseCSVLine(line);
                
                // Пропускаем заголовок если нужно
                if (index === 0 && (columns[0] === 'Вопрос' || columns[0].includes('?'))) {
                    return;
                }
                
                // Добавляем данные
                if (columns.length >= 3) {
                    rows.push({
                        question: columns[0] || '',
                        answer: columns[1] || '',
                        author: columns[2] || '',
                        rowNumber: index + 1
                    });
                }
            });
            
            return rows;
        }
        
        // Простой парсер CSV строки
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"' && nextChar === '"') {
                    current += '"';
                    i++; // Пропускаем следующий символ
} else if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }
        
        // Отображение данных в таблице
        function displayData(rows) {
            const tableBody = document.getElementById('tableBody');
            
            if (rows.length === 0) {
                tableBody.innerHTML = 
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 40px; color: #7f8c8d;">
                            Нет данных в таблице
                        </td>
                    </tr>
                ;
                return;
            }
            
            let html = '';
            
            rows.forEach((row, index) => {
                html += 
                    <tr>
                        <td>${index + 1}</td>
                        <td>${escapeHTML(row.question)}</td>
                        <td>${escapeHTML(row.answer)}</td>
                        <td>${escapeHTML(row.author)}</td>
                    </tr>
                ;
            });
            
            tableBody.innerHTML = html;
        }
        
        // Экранирование HTML
        function escapeHTML(text) {
            if (!text) return '';
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;')
                .replace(/\n/g, '<br>');
        }
        
        // Показать загрузку
        function showLoading() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = 
                <tr>
                    <td colspan="4" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Загрузка данных из Google Таблицы...</p>
                    </td>
                </tr>
            ;
        }
        
        // Показать ошибку
        function showError(message) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = 
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px; color: #e74c3c;">
                        <p style="margin-bottom: 15px;">${message}</p>
                        <button onclick="loadGoogleSheetData()" 
                                style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Попробовать снова
                        </button>
                    </td>
                </tr>
            ;
        }
        
        // Обновить время последнего обновления
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            document.getElementById('lastUpdate').textContent = timeString;
        }
        
        // Автообновление каждые 2 минуты
        function startAutoRefresh() {
            // Обновляем сразу при загрузке
            loadGoogleSheetData();
            
            // Затем каждые 2 минуты
            setInterval(loadGoogleSheetData, 2 * 60 * 1000);
        }
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', startAutoRefresh);
        
        // Обновление по клику на заголовок
        document.querySelector('h1').addEventListener('click', loadGoogleSheetData);
    </script>
</body>
</html>
