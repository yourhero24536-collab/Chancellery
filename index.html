<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система ответов на вопросы</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
        }
        .form-section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .table-section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .question-completed {
            background-color: #d4edda !important;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-completed {
            background-color: #28a745;
        }
        .status-pending {
            background-color: #ffc107;
        }
        .loading {
            display: none;
        }
        #googleSheetFrame {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Система ответов на вопросы</h1>
        
        <div class="row">
            <div class="col-md-4">
                <div class="form-section">
                    <h3>Форма ответа</h3>
                    <div id="statusMessage" class="alert" style="display: none;"></div>
                    
                    <div class="mb-3">
                        <label for="questionSelect" class="form-label">Выберите вопрос:</label>
                        <select id="questionSelect" class="form-select">
                            <option value="">-- Выберите вопрос --</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="respondentName" class="form-label">Ваше имя:</label>
                        <input type="text" id="respondentName" class="form-control" placeholder="Введите ваше имя">
                    </div>
                    
                    <div class="mb-3">
                        <label for="answerText" class="form-label">Ваш ответ:</label>
                        <textarea id="answerText" class="form-control" rows="4" placeholder="Введите ваш ответ..."></textarea>
                    </div>
                    
                    <button id="submitBtn" class="btn btn-primary w-100">Отправить ответ</button>
                    
                    <div class="loading mt-3 text-center" id="loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Загрузка...</span>
                        </div>
                        <p class="mt-2">Отправка данных...</p>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Статус вопросов</h4>
                    <div id="questionStatus"></div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="table-section">
                    <h3>Таблица вопросов</h3>
                    <div class="alert alert-info">
                        <small>Таблица загружается из Google Sheets. Если таблица не отображается, <a href="https://docs.google.com/spreadsheets/d/1bu4WDRv1H_YKGHaXpjGYkokmQPvBZvqtwwLB4DLWsk0/edit?usp=sharing" target="_blank">откройте ее напрямую</a>.</small>
                    </div>
                    <iframe id="googleSheetFrame" 
                            src="https://docs.google.com/spreadsheets/d/1bu4WDRv1H_YKGHaXpjGYkokmQPvBZvqtwwLB4DLWsk0/preview?rm=minimal&single=true&widget=true&headers=false">
                    </iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Подключаем необходимые библиотеки -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Конфигурация
        const SPREADSHEET_ID = '1bu4WDRv1H_YKGHaXpjGYkokmQPvBZvqtwwLB4DLWsk0';
        const API_KEY = 'YOUR_API_KEY'; // Вам нужно получить API ключ из Google Cloud Console
        
        // DOM элементы
        const questionSelect = document.getElementById('questionSelect');
        const respondentName = document.getElementById('respondentName');
        const answerText = document.getElementById('answerText');
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const statusMessage = document.getElementById('statusMessage');
        const questionStatus = document.getElementById('questionStatus');
        const googleSheetFrame = document.getElementById('googleSheetFrame');

        // Функция для отображения сообщения
        function showMessage(message, type = 'success') {
            statusMessage.textContent = message;
            statusMessage.className = `alert alert-${type}`;
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Функция для загрузки вопросов из Google Sheets
        async function loadQuestions() {
            try {
                // В реальном приложении здесь будет запрос к Google Sheets API
                // Для демонстрации используем заглушку
                
                // Пример структуры данных (в реальном приложении данные будут загружаться с Google Sheets)
                const questions = [
                    { id: 1, text: 'Вопрос 1: Что такое искусственный интеллект?', completed: false },
                    { id: 2, text: 'Вопрос 2: Как работает машинное обучение?', completed: true },
                    { id: 3, text: 'Вопрос 3: Что такое нейронные сети?', completed: false },
                    { id: 4, text: 'Вопрос 4: Примеры применения ИИ в бизнесе', completed: true },
                    { id: 5, text: 'Вопрос 5: Этические вопросы ИИ', completed: false }
                ];
                
                // Очищаем список
                questionSelect.innerHTML = '<option value="">-- Выберите вопрос --</option>';
                
                // Добавляем вопросы в выпадающий список
                questions.forEach(question => {
                    const option = document.createElement('option');
                    option.value = question.id;
                    option.textContent = question.text;
                    if (question.completed) {
                        option.disabled = true;
                        option.textContent += ' (Выполнено)';
                    }
                    questionSelect.appendChild(option);
                });
                
                // Обновляем статус вопросов
                updateQuestionStatus(questions);
                
            } catch (error) {
                console.error('Ошибка при загрузке вопросов:', error);
                showMessage('Ошибка при загрузке вопросов', 'danger');
            }
        }

        // Функция для обновления статуса вопросов
        function updateQuestionStatus(questions) {
            const completedCount = questions.filter(q => q.completed).length;
            const totalCount = questions.length;
            
            questionStatus.innerHTML = `
                <div class="progress mb-2">
                    <div class="progress-bar" role="progressbar" 
                         style="width: ${(completedCount / totalCount) * 100}%"
                         aria-valuenow="${completedCount}" 
                         aria-valuemin="0" 
                         aria-valuemax="${totalCount}">
                    </div>
                </div>
                <p>Выполнено: ${completedCount} из ${totalCount} вопросов</p>
            `;
        }

        // Функция для отправки ответа
        async function submitAnswer() {
            const questionId = questionSelect.value;
            const name = respondentName.value.trim();
            const answer = answerText.value.trim();
            
            // Валидация
            if (!questionId) {
                showMessage('Пожалуйста, выберите вопрос', 'warning');
                return;
            }
            
            if (!name) {
                showMessage('Пожалуйста, введите ваше имя', 'warning');
                return;
            }
            
            if (!answer) {
                showMessage('Пожалуйста, введите ответ', 'warning');
                return;
            }
            
            // Показываем индикатор загрузки
            loading.style.display = 'block';
            submitBtn.disabled = true;
            
            try {
                // В реальном приложении здесь будет запрос к Google Sheets API
                // для добавления данных в таблицу
                
                // Имитация задержки сети
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // В реальном приложении:
                // 1. Получаем данные из формы
                // 2. Отправляем POST запрос к Google Sheets API
                // 3. Обновляем статус вопроса как выполненный
                
                // Пример кода для работы с Google Sheets API:
                /*
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Sheet1!A:D:append?valueInputOption=USER_ENTERED`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${ACCESS_TOKEN}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            values: [[
                                new Date().toISOString(),
                                name,
                                `Вопрос ${questionId}`,
                                answer
                            ]]
                        })
                    }
                );
                */
                
                // Для демонстрации просто показываем успешное сообщение
                showMessage('Ответ успешно отправлен! Данные добавлены в таблицу.', 'success');
                
                // Сбрасываем форму
                respondentName.value = '';
                answerText.value = '';
                
                // Обновляем список вопросов
                await loadQuestions();
                
                // Обновляем iframe с таблицей
                googleSheetFrame.src = googleSheetFrame.src;
                
            } catch (error) {
                console.error('Ошибка при отправке ответа:', error);
                showMessage('Ошибка при отправке ответа. Попробуйте еще раз.', 'danger');
            } finally {
                // Скрываем индикатор загрузки
                loading.style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Загружаем вопросы
            loadQuestions();
            
            // Обработчик отправки формы
            submitBtn.addEventListener('click', submitAnswer);
            
            // Обработчики нажатия Enter
            respondentName.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') submitAnswer();
            });
            
            answerText.addEventListener('keypress', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    submitAnswer();
                }
            });
        });

        // Функция для работы с Google Sheets API (требуется настройка)
        /*
        Для реальной интеграции с Google Sheets API необходимо:
        
        1. Создать проект в Google Cloud Console
        2. Включить Google Sheets API
        3. Создать учетные данные (API ключ или OAuth 2.0)
        4. Настроить доступ к таблице
        
        Пример структуры таблицы:
        - Столбец A: Дата и время ответа
        - Столбец B: Имя отвечающего
        - Столбец C: Номер вопроса
        - Столбец D: Ответ
        - Столбец E: Статус (Выполнено/Не выполнено)
        */
    </script>
</body>
</html>
